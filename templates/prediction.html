<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    
    <title>Heart Diseases Analysis</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/carousel.css" rel="stylesheet">
  </head>
  <body>
    <nav class="navbar navbar-static-top navbar-light bg-faded">
      <ul class="nav navbar-nav" style="margin: 19px 4px 13px 0px;">
        <li class="nav-item active">
          <a class="nav-link" href="/">Home<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="">SourceCode</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/data_structure">Data Structure</a>
        </li>
        <li class="nav-item">
         <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" 
                    aria-expanded="false"> Visualizations
            </button>
            <ul class="dropdown-menu">
              <li><a href="/visual">Data Exploration</a></li>
              <li><a href="/quality">Data Quality</a></li>
            </ul>
         </div>
        </li>
       <li><a class="btn btn-primary" href="/form" role="button">TRY!!</a></li>
      </ul>
    </nav>

    ================================================== -->
    <!-- Wrap the rest of the page in another container to center all the content. -->

    <div>
        <div class="checkchecks">
          {% for row in rows %}
          <div class="checkbox" style="margin: 41px 11px 34px 84px;font-size: 30px;">
              {% for r in row %}
                  <label style="margin: 0px 35px 0px 0px;">
                    <input type="checkbox" value={{r}} name="type"/> {{r}}
                  </label>
              {% endfor %}
          </div>
        {% endfor %}
      </div>

    <button id="checkchecks">Checking</button>

      <div class="jumbotron">
        <h1><i>"What is My Risk of Heart Disease?"</i></h1>
        <p><a class="btn btn-primary btn-lg" href="/form" role="button">Start Prediction</a></p>
      </div>

      <!-- FOOTER -->
      <footer>
        
      </footer>

    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')</script>
    <script src="js/bootstrap.min.js"></script>
    <!-- Just to make our placeholder images work. Don't actually copy the next line! -->
    <script src="js/holder.min.js"></script>
        <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/uStates.js"></script> <!-- creates uStates. -->
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="d3/d3.v3.js"></script>

    <script>

        var selectedDimensions = ["age", "sex", "chol", "restecg"];

        $('#checkchecks').click(function(){
          selectedDimensions.length = 0;
          $("input:checkbox[name=type]:checked").each(function(){
            selectedDimensions.push($(this).val());
          })
           console.log(selectedDimensions);
           drawParallelCoordinate();
        })

        
        var margin, width, height, x, y, dragging, line, axis, background, foreground, svg;

        function addVars(){
            margin = {top: 30, right: 10, bottom: 10, left: 10},
                width = 960 - margin.left - margin.right,
                height = 500 - margin.top - margin.bottom;

            x = d3.scale.ordinal().rangePoints([0, width], 1),
                y = {},
                dragging = {};

            line = d3.svg.line(),
                axis = d3.svg.axis().orient("left"),
                background,
                foreground;

            svg = d3.select("body").append("svg").attr("id", "anisha")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        }

      var drawn = false;

      function drawParallelCoordinate(){

        if(drawn == true){
            console.log("entering here..");
            $("svg")[$("svg").length - 1].remove();
            addVars();
        }
      
        d3.csv("data/all_clean_data.csv", function(error, cars) {

        // Extract the list of dimensions and create a scale for each.
       

        x.domain(dimensions = selectedDimensions.filter(function(d) {

          // return d != "name" && (y[d] = d3.scale.linear()
          //     .domain(d3.extent(cars, function(p) { return +p[d]; }))
          //     .range([height, 0]));

          if(d === "datasource") {
              y[d] = d3.scale.ordinal()
                .domain(cars.map(function(p) { return p[d]; }))
                .rangePoints([height, 0]);

          }
          else {
              y[d] = d3.scale.linear()
                .domain(d3.extent(cars, function(p) { return +p[d]; }))
                .range([height, 0]);
          }

          return true;

        }));

        // Add grey background lines for context.
        background = svg.append("g")
            .attr("class", "background")
          .selectAll("path")
            .data(cars)
          .enter().append("path")
            .attr("d", path);

        // Add blue foreground lines for focus.
        foreground = svg.append("g")
          .attr("class", "foreground")
          .selectAll("path")
            .data(cars)
          .enter().append("path")
            .attr("d", path);

        // Add a group element for each dimension.
        var g = svg.selectAll(".dimension")
            .data(dimensions)
          .enter().append("g")
            .attr("class", "dimension")
            .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
            .call(d3.behavior.drag()
              .origin(function(d) { return {x: x(d)}; })
              .on("dragstart", function(d) {
                dragging[d] = x(d);
                background.attr("visibility", "hidden");
              })
              .on("drag", function(d) {
                dragging[d] = Math.min(width, Math.max(0, d3.event.x));
                foreground.attr("d", path);
                dimensions.sort(function(a, b) { return position(a) - position(b); });
                x.domain(dimensions);
                g.attr("transform", function(d) { return "translate(" + position(d) + ")"; })
              })
              .on("dragend", function(d) {
                delete dragging[d];
                transition(d3.select(this)).attr("transform", "translate(" + x(d) + ")");
                transition(foreground).attr("d", path);
                background
                    .attr("d", path)
                  .transition()
                    .delay(500)
                    .duration(0)
                    .attr("visibility", null);
              }));

            // Add an axis and title.
            g.append("g")
                .attr("class", "axis")
                .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
              .append("text")
                .style("text-anchor", "middle")
                .attr("y", -9)
                .text(function(d) { return d; });

            // Add and store a brush for each axis.
            g.append("g")
                .attr("class", "brush")
                .each(function(d) {
                  d3.select(this).call(y[d].brush = d3.svg.brush().y(y[d]).on("brushstart", brushstart).on("brush", brush));
                })
              .selectAll("rect")
                .attr("x", -8)
                .attr("width", 16);
          });

        }

        function position(d) {
          var v = dragging[d];
          return v == null ? x(d) : v;
        }

        function transition(g) {
          return g.transition().duration(500);
        }

        // Returns the path for a given data point.
        function path(d) {
          return line(dimensions.map(function(p) { return [position(p), y[p](d[p])]; }));
        }

        function brushstart() {
          d3.event.sourceEvent.stopPropagation();
        }

        // Handles a brush event, toggling the display of foreground lines.
        function brush() {
          var actives = dimensions.filter(function(p) { return !y[p].brush.empty(); }),
              extents = actives.map(function(p) { return y[p].brush.extent(); });
          foreground.style("display", function(d) {
            return actives.every(function(p, i) {
              return extents[i][0] <= d[p] && d[p] <= extents[i][1];
            }) ? null : "none";
          });
        }
        addVars();
        drawParallelCoordinate();
        drawn = true;
    </script>

  </body>
</html>
