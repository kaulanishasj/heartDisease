<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">
  <link href="css/d3.css" rel="stylesheet" type="text/css">
  
  <title>Heart Disease Analysis</title>
    
    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap theme -->
    <link href="css/bootstrap-theme.min.css" rel="stylesheet">
    <link href="css/parallel_viz.css" rel="stylesheet">
 </head>

  <body role="document">
    <!-- Fixed navbar -->
    <nav class="navbar navbar-static-top navbar-light bg-faded">
      <ul class="nav navbar-nav" style="margin: 19px 4px 13px 0px; ">
        <li class="nav-item">
          <a class="nav-link" href="/">Home<span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/source_code">SourceCode</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="/data_structure">Data Structure</a>
        </li>
        <li class="nav-item">
         <div class="btn-group">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" 
                    aria-expanded="false"> Visualizations
            </button>
            <ul class="dropdown-menu">
              <li style="background-color: #b91773"><a href="/visual">Data Exploration</a></li>
              <li><a href="/quality">Data Quality</a></li>
            </ul>
         </div>
        </li>
         <li><a class="btn btn-primary" href="/form" role="button">TRY!!</a></li>
      </ul>
    </nav>
     <div style="margin: 53px 85px 7px 49px;" align="center">
       <h3>
          <span class="text-muted">Write about: show that the data is normal.? are there any assumptions? are there any   
                outliers what could be  the cause? are there any relations between any two variables? summary of the datasets? some summary statistics? compare the variances of men and women from the map data?
          </span>
      </h3>
   
      
      <h>Number of Heart Disease Deaths per 100,000 Population</h>
      <p>With the following maps, you can explore how many heart disease deaths 
        occur by gender in your own state and compare it to others. Are you living
        in a state where high rates of heart disease? These visuals should give you 
        a sense of the general rates of heart disease mortality in the US. 
      </p>
      <button id="female" type="button" class="btn btn-secondary">Female</button>
      <button id="male" type="button" class="btn btn-secondary">Male</button>
      <button id="both" type="button" class="btn btn-secondary">Both</button>

      
      <div class="container">
          <div id="tooltip"></div>
          <svg width="960" height="600" id="statesvg"></svg>
          <svg width="960" height="600" id="femaleStates"></svg>
          <svg width="960" height="600" id="maleStates"></svg>
      </div>
      
      <div style="text-align:left;">
        <div class="container">
          <h2>Conditions that Increase Risk for Heart Disease</h2>
          <ul>
            <li>High Blood Pressure</li>
            <li><b>High Cholesterol</b></li>
            <li>Diabetes</li>
          </ul>
          <h2>Look at our data values filtered by the following features and see how High Cholesterol is related.</h2>
          <div class="row">
            <div class="col-md-3">
              <div class="row"><h2>Age</h2></div>
              <div class="row"><p>Participants' age in years</p></div>
            </div>
            <div class="col-md-3">
              <div class="row"><h2>Gender</h2></div>
              <div class="row"><p>Participants' gender (1=male, 0= female)</p></div>
            </div>
            <div class="col-md-3">
              <div class="row"><h2>Cholesterol</h2></div>
              <div class="row"><p>Participants' serum cholesterol which is 
                composed of high-density lipoprotein (HDL cholesterol), low-density
                lipoprotein (LDL cholesterol) and triglycerides measured in mg/dL. 
                The American Heart Association defines normal total cholesterol 
                as less than 200 mg/dL.</p>
              </div>
            </div>
            <div class="col-md-3">
              <div class="row"><h2>Resting Electrocardiographic Measure</h2></div>
              <div class="row"><p>Rating of participants' electrocardiograph.</p></div>
            </div>
          </div>
        </div>
      </div>
    </div>


    <div class="checkchecks">
       {% for row in rows %}
          <div class="checkbox" style="margin: 41px 11px 34px 84px;font-size: 30px;">
              {% for r in row %}
                  <label style="margin: 0px 35px 0px 0px;">
                    <input type="checkbox" value={{r}} name="type" /> {{r}}
                  </label>
              {% endfor %}
          </div>
        {% endfor %}
    </div>

    <button id="checkchecks">Checking</button>

</body>
    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/uStates.js"></script> <!-- creates uStates. -->
    <script src="js/jquery-1.11.3.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript" src="d3/d3.v3.js"></script>

    <script>
            // ----------- EVERY CHART NEEDS DATA -------------- 
              function tooltipHtml(n, d){ /* function to create html content string in tooltip div. */
                console.log(d)
                return "<h4>"+n+"</h4><table>"+
                  "<tr><td>Death Count</td><td>"+""+d.count+"</td></tr>"+
                  "</table>";
              }
                
                //Data Format?
                var stateData = {{both|safe}};
                var femaleData = {{female|safe}}
                var maleData = {{male|safe}}

                var states = {
                        'AK': 'Alaska',
                        'AL': 'Alabama',
                        'AR': 'Arkansas',
                        'AS': 'American Samoa',
                        'AZ': 'Arizona',
                        'CA': 'California',
                        'CO': 'Colorado',
                        'CT': 'Connecticut',
                        'DC': 'District of Columbia',
                        'DE': 'Delaware',
                        'FL': 'Florida',
                        'GA': 'Georgia',
                        'GU': 'Guam',
                        'HI': 'Hawaii',
                        'IA': 'Iowa',
                        'ID': 'Idaho',
                        'IL': 'Illinois',
                        'IN': 'Indiana',
                        'KS': 'Kansas',
                        'KY': 'Kentucky',
                        'LS': 'Louisiana',
                        'MA': 'Massachusetts',
                        'MD': 'Maryland',
                        'ME': 'Maine',
                        'MI': 'Michigan',
                        'MN': 'Minnesota',
                        'MO': 'Missouri',
                        'MP': 'Northern Mariana Islands',
                        'MS': 'Mississippi',
                        'MT': 'Montana',
                        'NA': 'National',
                        'NC': 'North Carolina',
                        'ND': 'North Dakota',
                        'NE': 'Nebraska',
                        'NH': 'New Hampshire',
                        'NJ': 'New Jersey',
                        'NM': 'New Mexico',
                        'NV': 'Nevada',
                        'NY': 'New York',
                        'OH': 'Ohio',
                        'OK': 'Oklahoma',
                        'OR': 'Oregon',
                        'PA': 'Pennsylvania',
                        'PR': 'Puerto Rico',
                        'RI': 'Rhode Island',
                        'SC': 'South Carolina',
                        'SD': 'South Dakota',
                        'TN': 'Tennessee',
                        'TX': 'Texas',
                        'UT': 'Utah',
                        'VA': 'Virginia',
                        'VI': 'Virgin Islands',
                        'VT': 'Vermont',
                        'WA': 'Washington',
                        'WI': 'Wisconsin',
                        'WV': 'West Virginia',
                        'WY': 'Wyoming'
                    }
                var sampleData ={}; /* Sample random data. */   
                ["HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
                "ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY", "OH", 
                "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ", "NV", "UT", 
                "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS", "IN", "IL", "MN", 
                "WI", "MO", "AR", "OK", "KS", "LS", "VA"]
                    .forEach(function(d){ 
                        var count = (stateData[states[d]]);
                        sampleData[d]={count:count, color:d3.interpolate("#ffffcc", "#800026")(count/100)}; 
                    });
                // data in format of: {StateName: {low, high, average, color}, StateName: {low, high, average, color}}
                
                /* draw states on id #statesvg */   

                var femaleSample = {};
                ["HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
                "ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY", "OH", 
                "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ", "NV", "UT", 
                "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS", "IN", "IL", "MN", 
                "WI", "MO", "AR", "OK", "KS", "LS", "VA"]
                    .forEach(function(d){ 
                        var count = (femaleData[states[d]]);
                        femaleSample[d]={count:count, color:d3.interpolate("#ffffcc", "#800026")(count/100)}; 
                    });

                var maleSample = {};
                ["HI", "AK", "FL", "SC", "GA", "AL", "NC", "TN", "RI", "CT", "MA",
                "ME", "NH", "VT", "NY", "NJ", "PA", "DE", "MD", "WV", "KY", "OH", 
                "MI", "WY", "MT", "ID", "WA", "DC", "TX", "CA", "AZ", "NV", "UT", 
                "CO", "NM", "OR", "ND", "SD", "NE", "IA", "MS", "IN", "IL", "MN", 
                "WI", "MO", "AR", "OK", "KS", "LS", "VA"]
                    .forEach(function(d){ 
                        var count = (maleData[states[d]]);
                        maleSample[d]={count:count, color:d3.interpolate("#ffffcc", "#800026")(count/100)}; 
                    });

                uStates.draw("#statesvg", sampleData, tooltipHtml);
                uStates.draw("#femaleStates", femaleSample, tooltipHtml);
                uStates.draw("#maleStates", maleSample, tooltipHtml);
            </script>

            <script>
            //AJAX SUPPORT
            $(document).ready(function(){
                $("#femaleStates").hide();
                $("#maleStates").hide();
                //Show only Female States
                $("#female").click(function(){
                    $("#statesvg").hide();
                    $("#maleStates").hide();
                    $("#femaleStates").show();
                });
                //Show both gender states
                $("#both").click(function(){
                    $("#statesvg").show();
                    $("#femaleStates").hide();
                    $("#maleStates").hide();
                });
                //Show only male states
                $("#male").click(function(){
                    $("#statesvg").hide();
                    $("#femaleStates").hide();
                    $("#maleStates").show();
                });
            });


    var selectedDimensions = ["age", "sex", "chol", "restecg"];

    $('#checkchecks').click(function(){
      selectedDimensions.length = 0;
      $("input:checkbox[name=type]:checked").each(function(){
        selectedDimensions.push($(this).val());
      })
       console.log(selectedDimensions);
       drawParallelCoordinate();
    })

    
    var margin, width, height, x, y, dragging, line, axis, background, foreground, svg;

    function addVars(){
        margin = {top: 30, right: 10, bottom: 10, left: 10},
            width = 960 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        x = d3.scale.ordinal().rangePoints([0, width], 1),
            y = {},
            dragging = {};

        line = d3.svg.line(),
            axis = d3.svg.axis().orient("left"),
            background,
            foreground;

        svg = d3.select("body").append("svg").attr("id", "anisha")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    }

   
    // function translateColumn(){
    //   console.log("************");
    //   console.log({{translators}});
    //     var tim = JSON.parse({{translators}});

        
    // }


  var drawn = false;

  function drawParallelCoordinate(){

    if(drawn == true){
        console.log("entering here..");
        $("svg")[$("svg").length - 1].remove();
        addVars();
    }
    

     console.log("Being plotted");
     console.log(selectedDimensions);
     console.log('{{rows}}');

    d3.csv("data/all_clean_data.csv", function(error, cars) {

    // Extract the list of dimensions and create a scale for each.
   

    x.domain(dimensions = selectedDimensions.filter(function(d) {

      // return d != "name" && (y[d] = d3.scale.linear()
      //     .domain(d3.extent(cars, function(p) { return +p[d]; }))
      //     .range([height, 0]));

      if(d === "datasource") {
          y[d] = d3.scale.ordinal()
            .domain(cars.map(function(p) { return p[d]; }))
            .rangePoints([height, 0]);

      }
      else {
          y[d] = d3.scale.linear()
            .domain(d3.extent(cars, function(p) { return +p[d]; }))
            .range([height, 0]);
      }

      return true;

    }));

    // Add grey background lines for context.
    background = svg.append("g")
        .attr("class", "background")
      .selectAll("path")
        .data(cars)
      .enter().append("path")
        .attr("d", path);

    // Add blue foreground lines for focus.
    foreground = svg.append("g")
      .attr("class", "foreground")
      .selectAll("path")
        .data(cars)
      .enter().append("path")
        .attr("d", path);

    // Add a group element for each dimension.
    var g = svg.selectAll(".dimension")
        .data(dimensions)
      .enter().append("g")
        .attr("class", "dimension")
        .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
        .call(d3.behavior.drag()
          .origin(function(d) { return {x: x(d)}; })
          .on("dragstart", function(d) {
            dragging[d] = x(d);
            background.attr("visibility", "hidden");
          })
          .on("drag", function(d) {
            dragging[d] = Math.min(width, Math.max(0, d3.event.x));
            foreground.attr("d", path);
            dimensions.sort(function(a, b) { return position(a) - position(b); });
            x.domain(dimensions);
            g.attr("transform", function(d) { return "translate(" + position(d) + ")"; })
          })
          .on("dragend", function(d) {
            delete dragging[d];
            transition(d3.select(this)).attr("transform", "translate(" + x(d) + ")");
            transition(foreground).attr("d", path);
            background
                .attr("d", path)
              .transition()
                .delay(500)
                .duration(0)
                .attr("visibility", null);
          }));

        // Add an axis and title.
        g.append("g")
            .attr("class", "axis")
            .each(function(d) { d3.select(this).call(axis.scale(y[d])); })
          .append("text")
            .style("text-anchor", "middle")
            .attr("y", -9)
            .text(function(d) { return d; });

        // Add and store a brush for each axis.
        g.append("g")
            .attr("class", "brush")
            .each(function(d) {
              d3.select(this).call(y[d].brush = d3.svg.brush().y(y[d]).on("brushstart", brushstart).on("brush", brush));
            })
          .selectAll("rect")
            .attr("x", -8)
            .attr("width", 16);
      });

    }

    function position(d) {
      var v = dragging[d];
      return v == null ? x(d) : v;
    }

    function transition(g) {
      return g.transition().duration(500);
    }

    // Returns the path for a given data point.
    function path(d) {
      return line(dimensions.map(function(p) { return [position(p), y[p](d[p])]; }));
    }

    function brushstart() {
      d3.event.sourceEvent.stopPropagation();
    }

    // Handles a brush event, toggling the display of foreground lines.
    function brush() {
      var actives = dimensions.filter(function(p) { return !y[p].brush.empty(); }),
          extents = actives.map(function(p) { return y[p].brush.extent(); });
      foreground.style("display", function(d) {
        return actives.every(function(p, i) {
          return extents[i][0] <= d[p] && d[p] <= extents[i][1];
        }) ? null : "none";
      });
    }
    addVars();
    // translateColumn();
    drawParallelCoordinate();
    drawn = true;


  </script>
</html>